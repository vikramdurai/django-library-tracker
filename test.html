<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Malhar Library</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        body {
            font-family: sans-serif;
        }
        #how {
            background-color:#d8d8d8;
            width: 30%;
            border-radius: 5px;
            padding: 5px;
        }
        a {
            text-decoration: none;
            color: blue;
        }
        a:hover {
            text-decoration: underline;
        }
        a:visited {
            color: blue;
        }
    </style>
    <!-- <link rel="stylesheet" type="text/css" media="screen" href="main.css" /> -->
    <!-- <script src="main.js"></script> -->
</head>

<body>
    Enter the ISBN code of the book you are going to add. <button onclick="show_how()">?</button><br>
    <div style="display:none;" id="how">
        <a href="#" onclick="hide_how()">Hide</a><br>
        Get the book, turn it around, and under the barcode should be a set<br>
        of numbers (and or numbers). Type in each of those, without typing in the hyphens ("-").<br><br>
        For example, if the numbers on the book are <em>"0-380-01159-x"</em>, then the numbers you type in
        should be <em>"038001159x"</em>. Otherwise this feature won't work.<br><br>

        If there are two sets of numbers then choose one. They'll
        both work.
        <br>
    </div>
    <input type="text" id="isbn"></input>
    <a href="#" onclick="isbn()">Add book</a>
    <div style="display:none" id="are-you-sure">
        <h2>Do you want to add this book?</h2>
        <p id="b-title"></p>
        <p id="b-author"></p>
        <p id="b-price"></p>
        <p id="b-genre"></p>
        <button id="b-submit" onclick="submit()">Yes</button>
        <button id="b-cancel" onclick="cancel()">Cancel</button>
    </div>
    <!-- <script src="js-barcode-reader.js"></script> -->
    <script>
        const LIBRARY_ID = 1;
        const SERVER_URL = "http://localhost:5000"
        var book = null;
        function submit() {
            fetch(SERVER_URL + "/api/newbook", {
                method: 'POST', // or 'PUT'
                body: JSON.stringify(book), // data can be `string` or {object}!
                headers: {
                    'Content-Type': 'application/json'
                }
            }).then(res => res.json())
                .then(response => console.log('Success:', JSON.stringify(response)))
                .catch(error => console.error('Error:', error));
        }
        function isbn() {
            var isbn_code = document.getElementById("isbn").value
            console.log(isbn_code)
            document.getElementById("isbn").value = "";
            fetch("https://www.googleapis.com/books/v1/volumes?q=isbn:" + isbn_code)
                .then(data => data.json())
                .then(function (res) {
                    var isbn_data = res.items[0].volumeInfo;
                    var data = {
                        title: (function () { return isbn_data.subtitle ? isbn_data.title + isbn_data.subtitle : isbn_data.title })(),
                        author: isbn_data.authors[0],
                        genre: (function () { return isbn_data["categories"] ? isbn_data["categories"] : "Not set yet" }()),
                        code: isbn_data.authors[0].split(" ")[0].slice(0, 1) + isbn_data.authors[0].split(" ")[1].slice(0, 1),
                        price: res.items[0].saleInfo.saleability,
                        user_id: LIBRARY_ID
                    }
                    book = data;
                    document.getElementById("are-you-sure").style.display = "block";
                    document.getElementById("b-title").innerHTML = "Title: <strong>" + data.title + "</strong>";
                    document.getElementById("b-author").innerHTML = "Author: " + data.author;
                    document.getElementById("b-price").innerHTML = "Price info: " + data.price;
                    document.getElementById("b-genre").innerHTML = "Genre: " + data.genre;
                    // docu
                })
                .catch(err => {
                    console.log("An error occurred:", err)
                })
        }
        function cancel() {
            book = null;
            document.getElementById("are-you-sure").style.display = "none";
        }
        function show_how() {
            document.getElementById("how").style.display = "block";
        }
        function hide_how() {
            document.getElementById("how").style.display = "none";
        }
    </script>
</body>

</html>